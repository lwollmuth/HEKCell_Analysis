//*************************************************************//Master panel menu. All other programs are accessed via this panel.//Written by LPW & others. //Most files especailly earlier ones assume the HEKA PatchMaster format: Window MainMenu() : Panel	PauseUpdate; Silent 1		// building window...	NewPanel /W=(1480,20,1660,950)	ModifyPanel cbRGB=(40000,40000,61439)	SetDrawLayer UserBackDrawText 10,20,"Loading Data"								//Slots - 25,50,75.	Button button_LoadITextData,pos={5,25},size={80,20},proc= MMenuButtonProc_LoadITextData,title="Igor Text"	Button button_LoadGTextData,pos={90,25},size={80,20},proc= MMenuButtonProc_LoadGTextData,title="General Text"	Button button_LoadExcelFile,pos={5,50},size={80,20},proc= MMenuButtonProc_LoadExcelFile,title="Excel"	Button button_HistoArea,pos={90,50},size={80,20},proc= MMenuButtonProc_HistoArea,title="empty"//**Begin program specific routinesDrawText 10,95,"Amplifier"								//Slots - 100	Button button_EPC10,pos={10,100},size={70,20},proc= MMenuButtonProc_EPC10,title="EPC 10"	Button button_Axon200B,pos={90,100},size={70,20},proc= MMenuButtonProc_Axon200B,title="Axon 200B"	DrawText 10,145,"Gating Analysis"						//Slots - 150,175,200,225,250,275,300	Button button_PulseAnal,pos={20,150},size={120,20},proc=MMenuButtonProc_PulseAnal,title="Single Pulse Analysis"	Button button_FastTrain,pos={10,175},size={70,20},proc= MMenuButtonProc_FastTrain,title="Fast Train"	Button button_SlowTrain,pos={90,175},size={70,20},proc= MMenuButtonProc_SlowTrain,title="Slow Train"		Button button_Recovery,pos={10,200},size={70,20},proc= MMenuButtonProc_Recovery,title="Recovery"	Button button_OpenTip,pos={10,225},size={70,20},proc= MMenuButtonProc_OPenTip,title="Open Tip"	Button button_DelaytoFirst,pos={15,250},size={130,20},proc= MMenuButtonProc_DelaytoFirst,title="Delay to First Opening"	Button button_ClusterDuration,pos={15,275},size={130,20},proc= MMenuButtonProc_ClusterDuration,title="Cluster Duration"	Button button_SummedDs,pos={15,300},size={130,20},proc= MMenuButtonProc_SummedDs,title="Summed Ds"DrawText 10,345,"Current-Voltage Analysis"				//Slots - 325,350,375,400,425.	Button button_PeakIVAnalysis,pos={20,350},size={120,20},proc= MMenuButtonProc_PeakIVAnalysis,title="Peak IV"		Button button_RevPotential,pos={10,375},size={70,20},proc= MMenuButtonProc_RevPotential,title="RevPot"	Button button_RampAnal,pos={90,375},size={70,20},proc= MMenuButtonProc_RampAnal,title="Ramp IVs"	Button button_SSIVAnal_AMPA,pos={20,400},size={120,20},proc= MMenuButtonProc_SSIVAnal_AMPA,title="SS IV-AMPAR"	Button button_SSIVAnal_NMDA,pos={20,425},size={120,20},proc= MMenuButtonProc_SSIVAnal_NMDA,title="SS IV-NMDAR"	Button button_PfMeasurements,pos={15,450},size={130,20},proc= MMenuButtonProc_PfMeasurements,title="Pf Measurements"DrawText 10,500,"Block Analysis"//	Button button_ChannelBlock,pos={20,535},size={120,20},proc= MMenuButtonProc_ChannelBlock,title="Channel Block"//	Button button_BlockKinetics,pos={20,560},size={120,20},proc=MMenuButtonProc_BlockKinetics,title="Block Kinetics"// DrawText 10,120,"Polyamine Block"  THis material was originally placed in 2nd Menu...needs placing...// Button button_ReBlock,pos={20,125},size={120,20},proc= MMenuButtonProc_ReBlock,title="ReBlock"// Button button_ReBlockLong,pos={20,150},size={120,20},proc= MMenuButtonProc_ReBlockLong,title="ReBlock-Long"// Button button_Escape,pos={20,175},size={120,20},proc= MMenuButtonProc_Escape,title="Escape"// Button button_EscapeTime, pos={20, 200},size={120,20},proc=MMenuButtonProc_EscapeTime,title="Escape_Time"// Button button_SubtCurveFit,pos={20,225},size={120,20},proc= MMenuButtonProc_SubtCurveFit,title="Subtract CFit"DrawText 10,555,"Concentration-response"	Button button_DRecord,pos={10,560},size={70,20},proc= MMenuButtonProc_DRecord,title="Def. record"	Button button_DRecord2,pos={90,560},size={70,20},proc= MMenuButtonProc_DRecord2,title="Dis. record"	Button button_CResponse,pos={10,585},size={70,20},proc= MMenuButtonProc_CRAnalysis,title="CR Anal"	Button button_CResp2,pos={90,585},size={70,20},proc= MMenuButtonProc_CRIndAnalysis,title="CR Ind"	//PopupMenu popup0 title="Rectification Ratio",value="Yes;No"				//This feature needs to be implemented....//**End program specific routinesDrawText 10,625,"Layouts"				//This section needs considerable work...simplify	Button button_DataParameters,pos={15,630},size={140,20},proc= MMenuButtonProc_DataParameters,title="Define Expt Parameters"	Button button_OverLayout,pos={10,655},size={70,20},proc= MMenuButtonProc_OverLayout,title="OverLayout"	Button button_AdjacentLayout,pos={90,655},size={70,20},proc= MMenuButtonProc_AdjacentLayout,title="AdjLayout."	Button button_CRLayout,pos={10,680},size={70,20},proc= MMenuButtonProc_CRLayout,title="empty"	Button button_RecoveryLayout,pos={90,680},size={70,20},proc= MMenuButtonProc_RecoveryLayout,title="Recovery"DrawText 10,720,"Data Export"	Button button_ExportTable,pos={20,725},size={120,20},proc= MMenuButtonProc_ExportTable,title="Export Table"	Button button_empty,pos={20,750},size={120,20},proc= MMenuButtonProc_empty,title="empty"DrawText 10,790,"House Keeping Buttons"	Button button_KillWaves,pos={20,795},size={100,20},proc= MMenuButtonProc_KillWaves,title="Kill Waves"	Button button_DeleteGraphs,pos={20,820},size={100,20},proc= MMenuButtonProc_DeleteGraphs,title="Delete Graphs"	Button button_ClearLayout,pos={20,845},size={100,20},proc= MMenuButtonProc_ClearLayout,title="Clear Layout"EndMacro//************************************************************************************************************************************************************************************//// **LOADING DATA////************************************************************************************************************************************************************************************//*** Loads Igor Text Files... Proc MMenuButtonProc_LoadITextData(ctrlName) : ButtonControl String ctrlName//	String/G GDate = "June 09, 2004"//	String/G GFilename = TextFileName//	String/G GRNA = "NR1-NR2C"//	String/G GTreatment = "Glu applns (2-4); 100 uM Cd2+ in the presence of Glu; Glu applns (3);  0.18 Ca2+"	LoadITextWaves()end//*** Loads General Text Files... LoadGTextDataProc MMenuButtonProc_LoadGTextData(ctrlName) : ButtonControl String ctrlName//	String/G GDate = "June 09, 2004"//	String/G GFilename = TextFileName//	String/G GRNA = "NR1-NR2C"//	String/G GTreatment = "Glu applns (2-4); 100 uM Cd2+ in the presence of Glu; Glu applns (3);  0.18 Ca2+"	Variable/G Gnumofwavesloaded		LoadGTextWaves()end//*** Loads General Excel Files...Proc MMenuButtonProc_LoadExcelFile(ctrlName) : ButtonControl String ctrlName	LoadExcelWaves()end//************************************************************************************************************************************************************************************//// **DATA PROCESSING////This section is specific for particular program.//	-Whole-cell Recordings//	-BrainSlices//	-ImageAnalysis//************************************************************************************************************************************************************************************//************************************************************************************************************************************************************************************//***Begin Program specific routines****//***Defining amplifier//While both EPC 10s and Axon instruments are interfaced with PatchMaster they generate slightly different file names.Proc MMenuButtonProc_EPC10(ctrlName) : ButtonControl			//Amplifier = EPC 10String ctrlName		String/G GWaveNameBase = "pulse"	String/G GEndNameBase = "_1_I-mon"	String/G GPiezoNameBase = "_2_Adc-2"	UserParameters()endProc MMenuButtonProc_Axon200B(ctrlName) : ButtonControl 		//Amplifier = Axon 200BString ctrlName		String/G GWaveNameBase = "pulse"	String/G GEndNameBase = "_1_CurrentIn"	String/G GPiezoNameBase = "_2_Adc-3"	UserParameters()end//**Allows user to input namesProc UserParameters(WaveNameBase,EndNameBase,PiezonameBase)	String WaveNameBase = GWaveNameBase		prompt WaveNameBase, "Base name of records (can also be defined when uploading):"	String EndNameBase = GEndNameBase		prompt EndNameBase, "Extension for current records:"	String PiezoNameBase = GPiezoNameBase		prompt PiezoNameBase, "Extension for piezo records:"	GWaveNameBase = WaveNameBase	GEndNameBase = EndNameBase	GPiezoNameBase = PiezoNameBaseend///////////////////////////////////////////////////////////////////////////// **Gating Analysis/////////////////////////////////////////////////////////////////////////////***Analysis of single pulseProc MMenuButtonProc_PulseAnal(ctrlName) : ButtonControl String ctrlName		Variable/G Gdatatype	Variable/G Ggroupno	Variable/G Gseriesno	Variable/G Gfirstsweepno	Variable/G Gtotalnosweeps	Variable/G Gstartss	Variable/G Gendss	Variable/G Gfitoffset	Variable/G Gfittype	PulseAnal()end//***Analysis of multiple fast agaonist applications. Proc MMenuButtonProc_FastTrain(ctrlName) : ButtonControl String ctrlName	Variable/G Gtype	Variable/G Gapplnnumber	Variable/G Giapplninterval	Variable/G Ggroupno	Variable/G Gseriesno	Variable/G Gfirstsweepno	Variable/G Gtotalnosweeps	Variable/G Gstartss	Variable/G Gendss	Variable/G Gfitoffset	FastTrain()end//***Analysis of multiple agonist applications over time. Proc MMenuButtonProc_SlowTrain(ctrlName) : ButtonControl String ctrlName	Variable/G Gtype	Variable/G Gapplnnumber	Variable/G Giapplninterval	Variable/G Ggroupno	Variable/G Gseriesno	Variable/G Gfirstsweepno			Variable/G Glastsweepno	Variable/G Gstartss	Variable/G Gendss	Variable/G Gfitoffset	SlowTrain()end//***Analysis of recovery from desensitization records. Proc MMenuButtonProc_Recovery(ctrlName) : ButtonControl String ctrlName	Recovery()end//***Analysis of open tip responses. Proc MMenuButtonProc_OpenTip(ctrlName) : ButtonControl String ctrlName	OpenTip()end//***Analysis of delay to first opening. Proc MMenuButtonProc_DelaytoFirst(ctrlName) : ButtonControlString ctrlName		Variable/G GCurrentAmplitude		DelaytoFirst()end	//***Analysis of delay to first opening. Proc MMenuButtonProc_ClusterDuration(ctrlName) : ButtonControlString ctrlName		Variable/G GCurrentAmplitude		ClusterDuration()end	//***Analysis of delay to first opening. Proc MMenuButtonProc_SummedDs(ctrlName) : ButtonControlString ctrlName		SummedDs()end	///////////////////////////////////////////////////////////////////////////// **Current-voltage Analysis/////////////////////////////////////////////////////////////////////////////**************************************************************// Analysis of peak current-voltage relationship. Proc MMenuButtonProc_PeakIVAnalysis(ctrlName) : ButtonControl String ctrlName	PeakIVAnalysis()end//*************************************************************// Analysis of Reversal Potentials. Proc MMenuButtonProc_RevPotential(ctrlName) : ButtonControl String ctrlName	RevPotential()end//*************************************************************// Analysis of Voltage ramps.Proc MMenuButtonProc_RampAnal(ctrlName) : ButtonControl String ctrlName	RampAnal()end//*************************************************************// Analysis of steady-state current-voltage relationships - non-NMDARs. Proc MMenuButtonProc_SSIVAnal_AMPA(ctrlName) : ButtonControl String ctrlName	SSIVAnal_AMPA()end//*************************************************************// Analysis of steady-state current-voltage relationships - NMDARs.  Includes analysis of Mg2+ block. Proc MMenuButtonProc_SSIVAnal_NMDA(ctrlName) : ButtonControl String ctrlName	SSIVAnal_NMDA()end//***Analysis of fractional Ca2+ currents. Proc MMenuButtonProc_PfMeasurements(ctrlName) : ButtonControl String ctrlName	Variable/G GGroupNo	Variable/G GSeriesNo	Variable/G Gfirstsweepno	Variable/G GBeadUnits 	PfMeasurements()end//*************************************************************//*************************************************************// Analysis of block kineticsProc MMenuButtonProc_BlockKinetics(ctrlName) :  ButtonControlString ctrlName		BlockKinetics()	end	///////////////////////////////////////////////////////////////////////////// **Concentration-Response Analysis///////////////////////////////////////////////////////////////////////////// Defining recordProc MMenuButtonProc_DRecord(ctrlName) :  ButtonControlString ctrlName		DRecord()	end////*************************************************************// Displaying recordProc MMenuButtonProc_DRecord2(ctrlName) :  ButtonControlString ctrlName		DRecord2()	end////*************************************************************// Analysis of Conc Response CurvesProc MMenuButtonProc_CRAnalysis(ctrlName) :  ButtonControlString ctrlName		CRAnalysis()	end	//*************************************************************// Analysis of Conc Response Curves -- Numbers onlyProc MMenuButtonProc_CRIndAnalysis(ctrlName) :  ButtonControlString ctrlName		CRIndAnalysis()	end	///////////////////////////////////////////////////////////////////////////// **Polyamine Analysis--not confirmed/////////////////////////////////////////////////////////////////////////////*************************************************************//Analysis of ReBlock of Closed Channels by Polyamines. Proc MMenuButtonProc_ReBlock(ctrlName) : ButtonControl String ctrlName	Variable/G GRBgroup	Variable/G GRBseries	Variable/G GRBsweepsS	Variable/G GRBsweepsM	Variable/G GRBsweepsL	Variable/G GRBVoltage	Variable/G GRBEndVoltage	Variable/G GRBteststart	ReBlock()end//Analysis of ReBlock of Closed Channels by Polyamines--Long Pulses (> 1 second in duration). Proc MMenuButtonProc_ReBlockLong(ctrlName) : ButtonControl String ctrlName	Variable/G GRBgroup	Variable/G GRBTestPotential	ReBlockLong()end//Analysis of Escape from Closed Channels by Polyamines. Proc MMenuButtonProc_Escape(ctrlName) : ButtonControl String ctrlName	Variable/G Gvoltage	Variable/G Gigroupno	Variable/G Gexpno	Variable/G Gtotalgroupno		Variable/G Gtpulsestart	Variable/G Gtpulseduration	EscapeAnalysis()end//Analysis of Time Dependence of Escape from Closed Channels by Polyamines. Proc MMenuButtonProc_EscapeTime(ctrlName) : ButtonControl String ctrlName	Variable/G Gvoltage	Variable/G Gigroupno	Variable/G Gexpno	Variable/G Gtotalgroupno		Variable/G Gtpulsestart	Variable/G Gtpulseduration	EscapeAnalysis_Time()end//***END program specific routines***//************************************************************************************************************************************************************************************//// **LAYOUTS////************************************************************************************************************************************************************************************//***Define experimental parameters. Proc MMenuButtonProc_DataParameters(ctrlName) : ButtonControl String ctrlName	DefineDataParameters()end//***Layouts with graphs on top of each other. Proc MMenuButtonProc_OverLayout(ctrlName) : ButtonControl String ctrlName	OverLayout()end//***Layouts with graphs adjacent to each other. Proc MMenuButtonProc_AdjacentLayout(ctrlName) : ButtonControl String ctrlName	AdjacentLayout()end//***Special layout for recovery form ds...Proc MMenuButtonProc_RecoveryLayout(ctrlName) : ButtonControl String ctrlName	RecoveryLayout()		end//************************************************************************************************************************************************************************************//// **DATA EXPORT////************************************************************************************************************************************************************************************//***Export of table. Proc MMenuButtonProc_ExportTable(ctrlName) : ButtonControl String ctrlName	ExportTable()end//************************************************************************************************************************************************************************************//// **HOUSE KEEP BUTTONS////************************************************************************************************************************************************************************************//***Routine kills Waves not used. Proc MMenuButtonProc_KillWaves(ctrlName) : ButtonControl String ctrlName//	Edit MMenuWave_SeriesInGroup,MMenuWave_SweepsInSeries				//Use if waves need to be protected	KillWaves/A/Zend//************************************************************************************************************************************************************************************//***Routine delete graphs with default names...Proc MMenuButtonProc_DeleteGraphs(ctrlName) : ButtonControl String ctrlName	String graphname	Variable delgraphno=0	Variable totalgroupno=10		do																			graphname="graph"+num2str(delgraphno)			DoWindow/K $graphname			DoWindow/K Table0					delgraphno +=1		while (delgraphno<(totalgroupno+1))end//*************************************************************// Remove from layout graphs/tables...Proc MMenuButtonProc_ClearLayout(ctrlName) : ButtonControl String ctrlName	String graphname,tablename	Variable delgraphno=0	Variable totalgroupno=10		do																			graphname="graph"+num2str(delgraphno)			tablename="table"+num2str(delgraphno)			Execute/Z "RemoveFromLayout $graphname"//				DoWindow/K $graphname			Execute/Z "RemoveFromLayout $tablename"//				DoWindow/K $tablename							delgraphno +=1					while (delgraphno<(totalgroupno+1))end//*************************************************************//NOT ACTIVE AT THIS TIMEFunction DeleteAllSweeps()String/G MMenuStr_SweepBaseNameVariable MMenuDis_Sweep,MMenuDis_ComplSweep												//Added by LPWVariable/G MMenuVar_TotalNumSweeps Variable i=1Silent 1	// kill all raw data sweeps	Do 		Wave AliasWave = $(MMenuStr_SweepBaseName+num2str(i))		killwaves AliasWave		Wave AliasWave = $(MMenuStr_SweepBaseName+num2str(i)+"_2nd")		killwaves AliasWave		 Wave AliasWave = $(MMenuStr_SweepBaseName+num2str(i)+"_3rd")		killwaves AliasWave		Wave AliasWave = $(MMenuStr_SweepBaseName+num2str(i)+"_4th")		killwaves AliasWave		i+=1	While(i<=MMenuVar_TotalNumSweeps)	MMenuDis_Sweep = 42					// so that you see there's nothing	MMenuDis_ComplSweep = 42			// so that you see there's nothing	//	if (!(strsearch(WinList( "MMenuGrMMenuh*", ";","WIN:1" ),"MMenuGrMMenuh_RawData",0) == -1 ))//		Execute "DoWindow/K MMenuGrMMenuh_RawData"//	endif		//	if (!(strsearch(WinList( "MMenuGrMMenuh*", ";","WIN:1" ),"MMenuGrMMenuh_Compl_RawData",0) == -1 ))//		Execute "DoWindow/K MMenuGrMMenuh_Compl_RawData"//	endif//	Execute "MMenuGrMMenuh_RawData()"			// show only RawDataGrMMenuh-Window reseted		MMenuVar_TotalNumSweeps = 0				// no sweeps there	Variable/G MMenuvar_SweepNumber = 1	// no comment	Variable /G nextNumber = 1					// Variable for next load (beginning sweepnr)	Variable /G MMenuVar_SetNumber 	MMenuVar_SetNumber += 1						// increment (next set will be loaded)	 	End///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// **Default Parameters/////////////////////////////////////////////////////////////////////////////Default parameters for Define Parameters	String/G Gdayofexperiment="July xx, 2011"	String/G GDNA="GluA1"	String/G Grecmode ="whole-cell"	String/G Gextsoln="140 NaCl, 10 Hepes, 1.8 CaCl2, 1 MgCl2, 3 glu, 0.6 KA, 0.03 CTZ"	String/G Gintsoln="140 KCl, 10 Hepes, 1 Bapta"//Default for Average Sweeps	Variable/G Gtype = 1	Variable/G Gfirstsweepno = 1	Variable/G Gtotalnosweeps = 6//Default parameters for Gating Analysis	//*Macro AnalyseCTZ	Variable/G Gtestgroupno = 1	Variable/G Gtestseriesno = 1	Variable/G Gtestsweepno = 1	Variable/G Goffsettopeak_ds = 1	Variable/G GCTZgroupno = 1	Variable/G GCTZseriesno = 4	Variable/G GCTZsweepno = 1		//*Macro Desensitization	Variable/G Gdeactgroupno=1	Variable/G Gdeactseriesno= 1	Variable/G Goffsettopeak_deact = 0	Variable/G Gdsgroupno=1	Variable/G Gdsseriesno= 1	Variable/G Goffsettopeak_ds = 0	Variable/G Gssstart=.02	Variable/G Gssend=.025	Variable/G Gdsvolt=-60	String/G Gdsagonist="5 glu"		//*Macro Recovery	Variable/G Ggroupno = 1	Variable/G Gseriesno = 5	Variable/G Gnoshortappln = 10	Variable/G Gnolongappln = 0	Variable/G Gincludefirst=0	Variable/G Gpulselength=100		//*Macro BlockKinetics	Variable/G Gcontrolgroupno=1	Variable/G Gvoltage=10		Variable/G Gblockgroupno=99	Variable/G Gblockseriesno=1	Variable/G Gendvoltage=80	String/G Gagonist="5 glutamate"	Variable/G Gmethod=2	Variable/G GstartfitKon=.0484	Variable/G GendfitKon=.078		//*Macro LongDeact	Variable/G Gldeactgroupno=2	Variable/G Gldeactseriesno=3	//Default parameters for IV Analysis	//*Macro PeakIVAnalysis & SSIVAnalysis	Variable/G Gnoofsweeps = 21		Variable/G Ggroupno=1	Variable/G Gseriesno = 2	Variable/G Gtotalgroupno = 1	Variable/G Gstartingvolts = -100	Variable/G Gvoltincrement =10	Variable/G Gstartbaseline = .01		Variable/G Gendbaseline = .02				Variable/G GstartSScurrent = 0.150				Variable/G GendSScurrent = 0.175	Variable/G Gapstart=.04		Variable/G Gapend=.07	Variable/G Gconductanceplot=1		Variable/G zeropot		Variable/G GNewGroup=99	Variable/G GPAgroups=3		Variable/G Gwindow = 30		//*Macro RampAnalysis	String/G Gtestsoln="NMDG, 2Ca2+, 0.5 Mg2+"	Variable/G Gpregroupno=1	Variable/G Gpreseriesno=1	Variable/G Gtestgroupno=2	Variable/G Gtestseriesno=1	Variable/G Gpostgroupno=3	Variable/G Gpostseriesno=1